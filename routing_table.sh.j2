#!/bin/sh

# Setting up routing tables
{% for device_name, device in devices.items() %}
{% if device.routes %}
ssh {{ device }} sysctl -w net.ipv4.ip_forward=1
{% for subnet, next_hop in device.routes.items() %}
ssh {{ device }} ip route add {{ subnet }} via {{ next_hop }}
{% endfor %}
{% endif %}
{% if device.default_gateway %}
ssh {{ device }} ip route add default via {{ device.default_gateway }}
{% endif %}
{% endfor %}
